v# **Область видимости (Scope) в JavaScript**  

**Область видимости** — это часть программы, в которой переменная или функция **доступна** для использования.  
Она определяет **контекст**, где переменные могут быть использованы, и как они взаимодействуют друг с другом.  

---

## 🔹 **Виды областей видимости**  

### 1. **Глобальная область видимости (Global Scope)**  
   - Переменные, объявленные **вне всех функций и блоков**, доступны **в любом месте программы**.  
   - Использовать глобальные переменные **не рекомендуется** (риск конфликтов имён).  

   ```javascript
   const globalVar = "Я глобальная!"; // Глобальная переменная

   function showGlobal() {
       console.log(globalVar); // Доступна внутри функции
   }

   showGlobal(); // "Я глобальная!"
   console.log(globalVar); // "Я глобальная!"
   ```

   **⚠️ Осторожно!**  
   - Присвоение переменной без `let`, `const` или `var` автоматически делает её глобальной (даже внутри функции):  
     ```javascript
     function createGlobal() {
         accidentalGlobal = "Упс, я глобальная!"; // Не используйте так!
     }
     createGlobal();
     console.log(accidentalGlobal); // "Упс, я глобальная!"
     ```

---

### 2. **Функциональная область видимости (Function Scope)**  
   - Переменные, объявленные внутри функции с `var`, видны **только внутри неё**.  
   - Не доступны снаружи.  

   ```javascript
   function myFunc() {
       var functionVar = "Я внутри функции!";
       console.log(functionVar); // "Я внутри функции!"
   }

   myFunc();
   // console.log(functionVar); // Ошибка! functionVar не определена
   ```

   **Особенности `var`:**  
   - Поднимается (`hoisting`) в начало функции.  
   - Не имеет блочной области видимости (см. ниже).  

---

### 3. **Блочная область видимости (Block Scope)**  
   - Появилась в **ES6** (`let` и `const`).  
   - Переменные внутри блока `{ ... }` (условия, циклы) видны **только в нём**.  

   ```javascript
   if (true) {
       let blockVar = "Я в блоке!";
       const alsoBlockVar = "И я тоже!";
       console.log(blockVar); // "Я в блоке!"
   }

   // console.log(blockVar); // Ошибка! blockVar не определена
   ```

   **Отличие от `var`:**  
   ```javascript
   for (var i = 0; i < 3; i++) {
       setTimeout(() => console.log(i)); // 3, 3, 3 (var не блочная)
   }

   for (let j = 0; j < 3; j++) {
       setTimeout(() => console.log(j)); // 0, 1, 2 (let блочная)
   }
   ```

---

### 4. **Лексическая область видимости (Lexical Scope)**  
   - Функция **запоминает**, где была объявлена, и имеет доступ к переменным из **внешних областей**.  
   - Основной механизм для **замыканий (closures)**.  

   ```javascript
   function outer() {
       const outerVar = "Я снаружи!";

       function inner() {
           console.log(outerVar); // "Я снаружи!" (доступ из внешней области)
       }

       inner();
   }

   outer();
   ```

   **Пример замыкания:**  
   ```javascript
   function createCounter() {
       let count = 0;
       return function() {
           return ++count;
       };
   }

   const counter = createCounter();
   console.log(counter()); // 1
   console.log(counter()); // 2 (count сохраняется)
   ```

---

### 5. **Область видимости модуля (Module Scope)**  
   - В **ES6-модулях** (`import`/`export`) переменные по умолчанию **не глобальные**.  
   - Доступны только внутри модуля, если не экспортированы.  

   **Файл `module.js`:**
   ```javascript
   const moduleVar = "Я в модуле!";
   export { moduleVar }; // Теперь можно импортировать
   ```

   **Файл `main.js`:**
   ```javascript
   import { moduleVar } from './module.js';
   console.log(moduleVar); // "Я в модуле!"
   ```

---

## 🔹 **Цепочка областей видимости (Scope Chain)**  
При обращении к переменной JavaScript ищет её:  
1. В текущей области видимости.  
2. Во внешних областях (по цепочке).  
3. В глобальной области.  
4. Если не найдено — `ReferenceError`.  

```javascript
const global = "Глобальная";

function outer() {
    const outerVar = "Внешняя";

    function inner() {
        const innerVar = "Внутренняя";
        console.log(innerVar); // "Внутренняя" (локальная)
        console.log(outerVar); // "Внешняя" (из outer)
        console.log(global); // "Глобальная" (из глобальной)
    }

    inner();
}

outer();
```

---

## 🔹 **Итог: виды областей видимости**  
| Тип области              | Где работает                     | Переменные               | Примеры                     |
|--------------------------|----------------------------------|--------------------------|----------------------------|
| **Глобальная**           | Везде                           | `var`, `let`, `const`    | `window.myVar` (в браузере)|
| **Функциональная**       | Внутри функции (`var`)           | `var`                    | `function() { var x; }`    |
| **Блочная**              | Внутри `{ }` (`let`, `const`)    | `let`, `const`           | `if (true) { let y; }`     |
| **Лексическая**          | Замыкания                       | Все                      | `function outer() { inner() }` |
| **Модульная**           | В ES6-модулях                   | `import`/`export`        | `export const z = 1;`      |

---

## 🔹 **Правила работы с областями видимости**  
1. **Избегайте глобальных переменных** — используйте модули и замыкания.  
2. **`const` и `let` > `var`** — блочная область надёжнее функциональной.  
3. **Замыкания** — мощный инструмент, но могут приводить к утечкам памяти.  
4. **Используйте `IIFE`** (Immediately Invoked Function Expression) для изоляции кода:  
   ```javascript
   (function() {
       var hidden = "Локальная область";
       console.log(hidden);
   })();
   // console.log(hidden); // Ошибка
   ```

Понимание областей видимости — ключ к написанию чистого и предсказуемого кода! 🚀
